var me=Object.create;var Vt=Object.defineProperty;var be=Object.getOwnPropertyDescriptor;var ve=Object.getOwnPropertyNames;var ge=Object.getPrototypeOf,ye=Object.prototype.hasOwnProperty;var we=(r,t)=>()=>(t||r((t={exports:{}}).exports,t),t.exports);var Me=(r,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of ve(t))!ye.call(r,i)&&i!==e&&Vt(r,i,{get:()=>t[i],enumerable:!(n=be(t,i))||n.enumerable});return r};var Te=(r,t,e)=>(e=r!=null?me(ge(r)):{},Me(t||!r||!r.__esModule?Vt(e,"default",{value:r,enumerable:!0}):e,r));var Nt=we(Y=>{(function(r,t){if(typeof define=="function"&&define.amd)define(["exports"],t);else if(typeof Y<"u")t(Y);else{var e={exports:{}};t(e.exports),r.jstoxml=e.exports}})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:Y,function(r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=r.toXML=void 0;function t(o){return i(o)||n(o)||h(o)||e()}function e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function n(o){if(typeof Symbol<"u"&&o[Symbol.iterator]!=null||o["@@iterator"]!=null)return Array.from(o)}function i(o){if(Array.isArray(o))return p(o)}function l(o,a){var s=Object.keys(o);if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(o);a&&(f=f.filter(function(b){return Object.getOwnPropertyDescriptor(o,b).enumerable})),s.push.apply(s,f)}return s}function c(o){for(var a=1;a<arguments.length;a++){var s=arguments[a]!=null?arguments[a]:{};a%2?l(Object(s),!0).forEach(function(f){S(o,f,s[f])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(s)):l(Object(s)).forEach(function(f){Object.defineProperty(o,f,Object.getOwnPropertyDescriptor(s,f))})}return o}function S(o,a,s){return a in o?Object.defineProperty(o,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):o[a]=s,o}function O(o,a){return A(o)||j(o,a)||h(o,a)||M()}function M(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function h(o,a){if(o){if(typeof o=="string")return p(o,a);var s=Object.prototype.toString.call(o).slice(8,-1);if(s==="Object"&&o.constructor&&(s=o.constructor.name),s==="Map"||s==="Set")return Array.from(o);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return p(o,a)}}function p(o,a){(a==null||a>o.length)&&(a=o.length);for(var s=0,f=new Array(a);s<a;s++)f[s]=o[s];return f}function j(o,a){var s=o==null?null:typeof Symbol<"u"&&o[Symbol.iterator]||o["@@iterator"];if(s!=null){var f=[],b=!0,g=!1,T,E;try{for(s=s.call(o);!(b=(T=s.next()).done)&&(f.push(T.value),!(a&&f.length===a));b=!0);}catch(I){g=!0,E=I}finally{try{!b&&s.return!=null&&s.return()}finally{if(g)throw E}}return f}}function A(o){if(Array.isArray(o))return o}function y(o){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?y=function(s){return typeof s}:y=function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},y(o)}var m={ARRAY:"array",BOOLEAN:"boolean",DATE:"date",FUNCTION:"function",JSTOXML_OBJECT:"jstoxml-object",NULL:"null",NUMBER:"number",OBJECT:"object",STRING:"string"},Ct=[m.STRING,m.NUMBER,m.BOOLEAN],Lt='<?xml version="1.0" encoding="UTF-8"?>',at=["_selfCloseTag","_attrs"],Dt=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return a.repeat(s)},U=function(a){return Array.isArray(a)&&m.ARRAY||y(a)===m.OBJECT&&a!==null&&a._name&&m.JSTOXML_OBJECT||a instanceof Date&&m.DATE||a===null&&m.NULL||y(a)},st=function(a){return a.startsWith("<![CDATA[")},ot=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},f=arguments.length>2?arguments[2]:void 0,b=a;if(y(a)===m.STRING){if(st(a))return a;var g=new RegExp("(".concat(Object.keys(s).join("|"),")(?!(\\w|#)*;)"),"g");b=String(a).replace(g,function(T,E){return s[E]||""})}return typeof f=="function"?f(b):b},Pt=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=arguments.length>1?arguments[1]:void 0,f=arguments.length>2?arguments[2]:void 0,b=arguments.length>3?arguments[3]:void 0,g=Array.isArray(a)?a:Object.entries(a).map(function(T){var E=O(T,2),I=E[0],x=E[1];return S({},I,x)});return g.reduce(function(T,E){var I=Object.keys(E)[0],x=E[I];if(y(f)===m.FUNCTION){var X=f(I,x);if(X)return T}var R=s?ot(x,s):x,Z=!b&&R===!0?"":'="'.concat(R,'"');return T.push("".concat(I).concat(Z)),T},[])},Bt=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=arguments.length>1?arguments[1]:void 0,f=arguments.length>2?arguments[2]:void 0,b=arguments.length>3?arguments[3]:void 0,g=Pt(a,s,f,b);if(g.length===0)return"";var T=g.join(" ");return" ".concat(T)},zt=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.keys(a).map(function(s){return{_name:s,_content:a[s]}})},Ft=function(a){return Ct.includes(U(a))},$t=function(a){return!a.match("<")},Ut=function(a){var s=a.header,f=a.isOutputStart,b=s&&f;if(!b)return"";var g=y(s)===m.BOOLEAN;return g?Lt:s},ut={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;"},lt=function o(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},f=s.depth,b=f===void 0?0:f,g=s.indent,T=s._isFirstItem,E=s._isOutputStart,I=E===void 0?!0:E,x=s.header,X=s.attributeReplacements,R=X===void 0?{}:X,Z=s.attributeFilter,ct=s.attributeExplicitTrue,qt=ct===void 0?!1:ct,ht=s.contentReplacements,Q=ht===void 0?{}:ht,pt=s.contentMap,ft=s.selfCloseTags,Jt=ft===void 0?!0:ft,Gt=typeof R=="boolean"&&!R,Ht=Gt?{}:c(c({},ut),R),Yt=typeof Q=="boolean"&&!Q,Wt=Yt?{}:c(c({},ut),Q),dt=typeof g=="string",tt=Dt(g,b),Zt=U(a),mt=Ut({header:x,indent:g,depth:b,isOutputStart:I}),q=I&&!mt&&T&&b===0,bt=dt&&!q?`
`:"",k="";switch(Zt){case m.JSTOXML_OBJECT:{var C=a._name,L=a._content;if(L===null&&typeof pt!="function"){k="".concat(bt).concat(tt).concat(C);break}var Qt=Array.isArray(L)&&L.every(Ft);if(Qt){var te=L.map(function(V){return o({_name:C,_content:V},c(c({},s),{},{depth:b,_isOutputStart:!1}))});return te.join("")}if(at.includes(C))break;var P=o(L,c(c({},s),{},{depth:b+1,_isOutputStart:q})),ee=U(P),re=$t(P),ne=st(P),vt="".concat(bt).concat(tt);if(C==="_comment"){k+="".concat(vt,"<!-- ").concat(L," -->");break}var gt=ee==="undefined"||P==="",ie=Jt,yt=a._selfCloseTag,wt=y(yt)===m.BOOLEAN?gt&&yt:gt&&ie,ae=wt?"/":"",se=Bt(a._attrs,Ht,Z,qt),oe="<".concat(C).concat(se).concat(ae,">"),ue=dt&&!re&&!ne?`
`.concat(tt):"",le=wt?"":"".concat(P).concat(ue,"</").concat(C,">");k+="".concat(vt).concat(oe).concat(le);break}case m.OBJECT:{var Mt=Object.keys(a),ce=Mt.map(function(V,B){var et=c(c({},s),{},{_isFirstItem:B===0,_isLastItem:B+1===Mt.length,_isOutputStart:q}),z={_name:V};if(U(a[V])===m.OBJECT){at.forEach(function(rt){var Et=a[V][rt];typeof Et<"u"&&(z[rt]=Et,delete a[V][rt])});var fe=typeof a[V]._content<"u";if(fe&&Object.keys(a[V]).length>1){var Tt=Object.assign({},a[V]);delete Tt._content,z._content=[].concat(t(zt(Tt)),[a[V]._content])}}typeof z._content>"u"&&(z._content=a[V]);var de=o(z,et);return de},s);k=ce.join("");break}case m.FUNCTION:{var he=a(s);k=o(he,s);break}case m.ARRAY:{var pe=a.map(function(V,B){var et=c(c({},s),{},{_isFirstItem:B===0,_isLastItem:B+1===a.length,_isOutputStart:q});return o(V,et)});k=pe.join("");break}default:{k=ot(a,Wt,pt);break}}return"".concat(mt).concat(k)};r.toXML=lt;var Xt={toXML:lt};r.default=Xt})});var Ee=2e3,u={s:1,n:0,d:1};function N(r,t){if(isNaN(r=parseInt(r,10)))throw J();return r*t}function d(r,t){if(t===0)throw nt();var e=Object.create(v.prototype);e.s=r<0?-1:1,r=r<0?-r:r;var n=D(r,t);return e.n=r/n,e.d=t/n,e}function Kt(r){for(var t={},e=r,n=2,i=4;i<=e;){for(;e%n===0;)e/=n,t[n]=(t[n]||0)+1;i+=1+2*n++}return e!==r?e>1&&(t[e]=(t[e]||0)+1):t[r]=(t[r]||0)+1,t}var K=function(r,t){var e=0,n=1,i=1,l=0,c=0,S=0,O=1,M=1,h=0,p=1,j=1,A=1,y=1e7,m;if(r!=null)if(t!==void 0){if(e=r,n=t,i=e*n,e%1!==0||n%1!==0)throw Oe()}else switch(typeof r){case"object":{if("d"in r&&"n"in r)e=r.n,n=r.d,"s"in r&&(e*=r.s);else if(0 in r)e=r[0],1 in r&&(n=r[1]);else throw J();i=e*n;break}case"number":{if(r<0&&(i=r,r=-r),r%1===0)e=r;else if(r>0){for(r>=1&&(M=Math.pow(10,Math.floor(1+Math.log(r)/Math.LN10)),r/=M);p<=y&&A<=y;)if(m=(h+j)/(p+A),r===m){p+A<=y?(e=h+j,n=p+A):A>p?(e=j,n=A):(e=h,n=p);break}else r>m?(h+=j,p+=A):(j+=h,A+=p),p>y?(e=j,n=A):(e=h,n=p);e*=M}else(isNaN(r)||isNaN(t))&&(n=e=NaN);break}case"string":{if(p=r.match(/\d+|./g),p===null)throw J();if(p[h]==="-"?(i=-1,h++):p[h]==="+"&&h++,p.length===h+1?c=N(p[h++],i):p[h+1]==="."||p[h]==="."?(p[h]!=="."&&(l=N(p[h++],i)),h++,(h+1===p.length||p[h+1]==="("&&p[h+3]===")"||p[h+1]==="'"&&p[h+3]==="'")&&(c=N(p[h],i),O=Math.pow(10,p[h].length),h++),(p[h]==="("&&p[h+2]===")"||p[h]==="'"&&p[h+2]==="'")&&(S=N(p[h+1],i),M=Math.pow(10,p[h+1].length)-1,h+=3)):p[h+1]==="/"||p[h+1]===":"?(c=N(p[h],i),O=N(p[h+2],1),h+=3):p[h+3]==="/"&&p[h+1]===" "&&(l=N(p[h],i),c=N(p[h+2],i),O=N(p[h+4],1),h+=5),p.length<=h){n=O*M,i=e=S+n*l+M*c;break}}default:throw J()}if(n===0)throw nt();u.s=i<0?-1:1,u.n=Math.abs(e),u.d=Math.abs(n)};function Ve(r,t,e){for(var n=1;t>0;r=r*r%e,t>>=1)t&1&&(n=n*r%e);return n}function Ke(r,t){for(;t%2===0;t/=2);for(;t%5===0;t/=5);if(t===1)return 0;for(var e=10%t,n=1;e!==1;n++)if(e=e*10%t,n>Ee)return 0;return n}function _e(r,t,e){for(var n=1,i=Ve(10,e,t),l=0;l<300;l++){if(n===i)return l;n=n*10%t,i=i*10%t}return 0}function D(r,t){if(!r)return t;if(!t)return r;for(;;){if(r%=t,!r)return t;if(t%=r,!t)return r}}function v(r,t){if(K(r,t),this instanceof v)r=D(u.d,u.n),this.s=u.s,this.n=u.n/r,this.d=u.d/r;else return d(u.s*u.n,u.d)}var nt=function(){return new Error("Division by Zero")},J=function(){return new Error("Invalid argument")},Oe=function(){return new Error("Parameters must be integer")};v.prototype={s:1,n:0,d:1,abs:function(){return d(this.n,this.d)},neg:function(){return d(-this.s*this.n,this.d)},add:function(r,t){return K(r,t),d(this.s*this.n*u.d+u.s*this.d*u.n,this.d*u.d)},sub:function(r,t){return K(r,t),d(this.s*this.n*u.d-u.s*this.d*u.n,this.d*u.d)},mul:function(r,t){return K(r,t),d(this.s*u.s*this.n*u.n,this.d*u.d)},div:function(r,t){return K(r,t),d(this.s*u.s*this.n*u.d,this.d*u.n)},clone:function(){return d(this.s*this.n,this.d)},mod:function(r,t){if(isNaN(this.n)||isNaN(this.d))return new v(NaN);if(r===void 0)return d(this.s*this.n%this.d,1);if(K(r,t),u.n===0&&this.d===0)throw nt();return d(this.s*(u.d*this.n)%(u.n*this.d),u.d*this.d)},gcd:function(r,t){return K(r,t),d(D(u.n,this.n)*D(u.d,this.d),u.d*this.d)},lcm:function(r,t){return K(r,t),u.n===0&&this.n===0?d(0,1):d(u.n*this.n,D(u.n,this.n)*D(u.d,this.d))},ceil:function(r){return r=Math.pow(10,r||0),isNaN(this.n)||isNaN(this.d)?new v(NaN):d(Math.ceil(r*this.s*this.n/this.d),r)},floor:function(r){return r=Math.pow(10,r||0),isNaN(this.n)||isNaN(this.d)?new v(NaN):d(Math.floor(r*this.s*this.n/this.d),r)},round:function(r){return r=Math.pow(10,r||0),isNaN(this.n)||isNaN(this.d)?new v(NaN):d(Math.round(r*this.s*this.n/this.d),r)},roundTo:function(r,t){return K(r,t),d(this.s*Math.round(this.n*u.d/(this.d*u.n))*u.n,u.d)},inverse:function(){return d(this.s*this.d,this.n)},pow:function(r,t){if(K(r,t),u.d===1)return u.s<0?d(Math.pow(this.s*this.d,u.n),Math.pow(this.n,u.n)):d(Math.pow(this.s*this.n,u.n),Math.pow(this.d,u.n));if(this.s<0)return null;var e=Kt(this.n),n=Kt(this.d),i=1,l=1;for(var c in e)if(c!=="1"){if(c==="0"){i=0;break}if(e[c]*=u.n,e[c]%u.d===0)e[c]/=u.d;else return null;i*=Math.pow(c,e[c])}for(var c in n)if(c!=="1"){if(n[c]*=u.n,n[c]%u.d===0)n[c]/=u.d;else return null;l*=Math.pow(c,n[c])}return u.s<0?d(l,i):d(i,l)},equals:function(r,t){return K(r,t),this.s*this.n*u.d===u.s*u.n*this.d},compare:function(r,t){K(r,t);var e=this.s*this.n*u.d-u.s*u.n*this.d;return(0<e)-(e<0)},simplify:function(r){if(isNaN(this.n)||isNaN(this.d))return this;r=r||.001;for(var t=this.abs(),e=t.toContinued(),n=1;n<e.length;n++){for(var i=d(e[n-1],1),l=n-2;l>=0;l--)i=i.inverse().add(e[l]);if(Math.abs(i.sub(t).valueOf())<r)return i.mul(this.s)}return this},divisible:function(r,t){return K(r,t),!(!(u.n*this.d)||this.n*u.d%(u.n*this.d))},valueOf:function(){return this.s*this.n/this.d},toFraction:function(r){var t,e="",n=this.n,i=this.d;return this.s<0&&(e+="-"),i===1?e+=n:(r&&(t=Math.floor(n/i))>0&&(e+=t,e+=" ",n%=i),e+=n,e+="/",e+=i),e},toLatex:function(r){var t,e="",n=this.n,i=this.d;return this.s<0&&(e+="-"),i===1?e+=n:(r&&(t=Math.floor(n/i))>0&&(e+=t,n%=i),e+="\\frac{",e+=n,e+="}{",e+=i,e+="}"),e},toContinued:function(){var r,t=this.n,e=this.d,n=[];if(isNaN(t)||isNaN(e))return n;do n.push(Math.floor(t/e)),r=t%e,t=e,e=r;while(t!==1);return n},toString:function(r){var t=this.n,e=this.d;if(isNaN(t)||isNaN(e))return"NaN";r=r||15;var n=Ke(t,e),i=_e(t,e,n),l=this.s<0?"-":"";if(l+=t/e|0,t%=e,t*=10,t&&(l+="."),n){for(var c=i;c--;)l+=t/e|0,t%=e,t*=10;l+="(";for(var c=n;c--;)l+=t/e|0,t%=e,t*=10;l+=")"}else for(var c=r;t&&c--;)l+=t/e|0,t%=e,t*=10;return l}};function _t(r){return r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Ot(r,t=!1){return t?r.abs().compare(1)<0?r.inverse():r:r.abs().compare(1)>0?r.inverse():r}function St(r,t,e){let n=0,i=r.length-1;for(;n<=i;){let l=i+n>>1,c=e(t,r[l]);if(c>0)n=l+1;else if(c<0)i=l-1;else return l}return~n}function F(r,t){return(r%t+t)%t}function At(r,t){let e=1/t;return Math.round(r*e)/e}var w=class r{constructor(t){this.ratio=t}get cents(){return 1200*Math.log2(this.ratio.valueOf())}get savarts(){return 1e3*Math.log10(this.ratio.valueOf())}difference(t){return new r(this.ratio.div(t.ratio))}static fromRatio(t){return new r(new v(t))}static fromCents(t){return new r(new v(Math.pow(2,t/1200)))}static fromSavarts(t){return new r(new v(Math.pow(10,t/1e3)))}static compare(t,e){return t.ratio.compare(e.ratio)}static JND=r.fromCents(5)};var G=class r{constructor(t,e=[]){this.intervals=t;this.annotations=e;this.intervals.sort(w.compare),this.intervals[0].ratio.valueOf()!=1&&(this.intervals=[new w(new v(1)),...this.intervals])}static fromIntervals(t,e=[]){return new r(t.map(n=>typeof n=="string"?new w(new v(n)):w.fromCents(n)),e)}_transposable;get transposable(){if(this._transposable!==void 0)return this._transposable;let t=this.intervals[1].difference(this.intervals[0]);return this._transposable=this.intervals.slice(1).every((e,n)=>{let i=e.difference(this.intervals[n]);return new w(Ot(i.difference(t).ratio,!0)).ratio.compare(w.JND.ratio)<0})}get steps(){return this.intervals.length-1}get octave(){return this.intervals[this.steps]}tune(t){return new w(this.intervals[t.pitchClass].ratio.mul(this.octave.ratio.pow(t.octave)))}nearest(t){let e=Math.floor(Math.log(t.ratio.valueOf())/Math.log(this.octave.ratio.valueOf())),n=new w(t.ratio.div(this.octave.ratio.pow(e))),i=St(this.intervals,n,w.compare);if(i>=0)return{tone:new _(this,i,e),interval:t,difference:new w(new v(1))};{let l=~i,c=Math.abs(this.intervals[l-1].difference(n).cents),S=Math.abs(this.intervals[l].difference(n).cents),O=c<S?l-1:l,M=new _(this,O,e),h=this.tune(M);return{tone:M,interval:h,difference:h.difference(t)}}}static fromEdo(t){return new r(Array.from(Array(t+1)).map((e,n)=>w.fromCents(1200/t*n)))}},_=class r{constructor(t,e,n){this.tuning=t;this.pitchClass=e;this.octave=n}get pitch(){return this.pitchClass+this.octave*this.tuning.steps}get tune(){return this.tuning.tune(this)}static fromPitch(t,e){return new r(t,F(e,t.steps),Math.floor(e/t.steps))}};var $=class{keyValueMap=new Map;valueKeyMap=new Map;get size(){return this.keyValueMap.size}[Symbol.toStringTag];[Symbol.iterator]=this.keyValueMap[Symbol.iterator];entries=()=>this.keyValueMap.entries();keys=()=>this.keyValueMap.keys();values=()=>this.keyValueMap.values();get=t=>this.keyValueMap.get(t);getKey=t=>this.valueKeyMap.get(t);getValue=t=>this.get(t);set=(t,e)=>{this.delete(t),this.keyValueMap.set(t,e);let n=this.valueKeyMap.get(e)||[];return this.valueKeyMap.set(e,[...n,t]),this};setKey=(t,e)=>this.set(e,t);setValue=(t,e)=>this.set(t,e);clear=()=>{this.keyValueMap.clear(),this.valueKeyMap.clear()};delete=t=>{if(this.has(t)){let e=this.keyValueMap.get(t);this.keyValueMap.delete(t);let n=this.valueKeyMap.get(e).filter(i=>i!==t);return n.length>0?this.valueKeyMap.set(e,n):this.valueKeyMap.delete(e),!0}return!1};deleteKey=t=>this.delete(t);deleteValue=t=>this.hasValue(t)?(this.valueKeyMap.get(t).forEach(e=>{this.delete(e)}),!0):!1;forEach=(t,e)=>{this.keyValueMap.forEach((n,i)=>{t.apply(e,[n,i,this])})};has=t=>this.keyValueMap.has(t);hasKey=t=>this.has(t);hasValue=t=>this.valueKeyMap.has(t);inspect=()=>{let t="Multimap {",e=0;return this.forEach((n,i)=>{e++,t+=""+i.toString()+" => "+n.toString(),e<this.size&&(t+=", ")}),t+="}",t}};var H=class{constructor(t,e,n){this.tuning=t;this.notes=e;this.accidentals=n;this.parseMap=new $,Object.keys(e).forEach(i=>{this.parseMap.set(i,e[i]),Object.keys(n).forEach(l=>{this.parseMap.set(`${i}${l}`,F(e[i]+n[l],t.steps))})}),this.nameMap=new $,Object.keys(e).forEach(i=>{let l=[0];this.nameMap.set(i,e[i]),Object.keys(n).forEach(c=>{l.includes(n[c])||(this.nameMap.set(`${i}${c}`,F(e[i]+n[c],t.steps)),l.push(n[c]))})}),this.regex=new RegExp("^("+Array.from(this.parseMap.keys()).map(_t).join("|")+")(-?\\d)$","i")}regex;nameMap;parseMap;name(t){return[...this.nameMap.getKey(t.pitchClass)].sort((n,i)=>n.length-i.length).map(n=>`${n}${t.octave}`)}parse(t){let e=this.regex.exec(t);if(!e)throw new Error(`[Solmization.parse] Could not match note ${t}`);return new _(this.tuning,this.parseMap.get(e[1]),parseInt(e[2],10))}};var it=class r{constructor(t,e,n=[]){this.tuning=t;this.tones=e;this.annotations=n;if(e.some((i,l)=>!!e.slice(l+1).find(c=>c.pitchClass===i.pitchClass)))throw Error("Found repeating pitch class in tone row.")}transpose(t){return new r(this.tuning,this.tones.map(e=>_.fromPitch(this.tuning,t.pitch+e.pitch)))}invert(t){return new r(this.tuning,this.tones.map(e=>_.fromPitch(this.tuning,t.pitch-e.pitch)))}reverse(){return new r(this.tuning,[...this.tones].reverse())}rotate(t){let e=t%this.tones.length;return new r(this.tuning,[...this.tones.slice(e),...this.tones.slice(0,e)])}monotonize(t=!1){return new r(this.tuning,this.tones.reduce((e,n)=>{let i=e.length>0?e[e.length-1]:n;return!t&&n.pitch<i.pitch?e.push(new _(this.tuning,n.pitchClass,i.octave+(n.pitchClass<i.pitchClass?1:0))):t&&n.pitch>i.pitch?e.push(new _(this.tuning,n.pitchClass,i.octave+(n.pitchClass>i.pitchClass?-1:0))):e.push(n),e},[]))}get pitches(){return this.tones.map(t=>t.pitch)}static fromPitches(t,e,n=[]){return new r(t,e.map(i=>_.fromPitch(t,i)),n)}static fromPitchClasses(t,e,n,i=[]){return new r(t,e.map(l=>new _(t,l,n)),i)}},It=class r extends it{constructor(e,n,i,l=[]){super(e,i,l);this.tuning=e;this.solmization=n;this.tones=i;this.annotations=l}static fromToneRow(e,n){return new r(e.tuning,n,e.tones,e.annotations)}};var Rt=Te(Nt(),1);var W=class{constructor(t,e){this.label=t;this.value=e}static findByLabel(t,e){return e.filter(n=>n.label===t).map(n=>n.value)}};var jt={name:"scalextric",version:"0.5.0",description:"Like Unicode, but for music. Ish.",type:"module",types:"./build/types/index.d.ts",exports:{import:"./build/scalextric.js",require:"./build/scalextric.cjs"},scripts:{build:"npm run build:esm && npm run build:cjs && npm run build:d.ts","build:esm":"esbuild src/index.ts --bundle --format=esm --minify --sourcemap --outfile=build/scalextric.js","build:cjs":"esbuild src/index.ts --bundle --platform=node --packages=external --minify --sourcemap --outfile=build/scalextric.cjs","build:d.ts":"tsc --emitDeclarationOnly --outDir build/types",test:"npm run test:lint && npm run test:ts && npm run test:js","test:lint":"eslint src","test:ts":'tsx --tsconfig ./tsconfig.json --test test/*.spec.ts --test-name-pattern="${TEST:-.*}" ',"test:js":"node --test test/*.spec.js","build:chords":"python src/utils/chordtable/generate.py > data/chords.json && echo 'Generate data/chords.json file'","build:scala":'wget -q -O data/scales.zip http://huygens-fokker.org/docs/scales.zip && unzip -o data/scales.zip -d data/ && for f in data/scl/*; do iconv -f iso-8859-1 -t utf-8 "$f" -o "$f"; done'},author:"Karim Ratib <karim.ratib@gmail.com> (https://github.com/infojunkie)",license:"GPL-3.0-only",devDependencies:{"@eslint/js":"^9.17.0","@types/jstoxml":"^2.0.4","@types/node":"^22.10.2",esbuild:"^0.24.0",eslint:"^9.17.0","ts-node":"^10.9.2",tsx:"^4.19.2",typescript:"^5.7.2","typescript-eslint":"^8.18.1","validate-with-xmllint":"^1.2.1"},dependencies:{"fraction.js":"^4.1.2",jstoxml:"^3.2.6"}};var{toXML:Ae}=Rt.default,kt="4.0",xt=class r{constructor(t,e,n={}){this.title=t;this.objects=e;this.options=Object.assign({},r.defaultOptions,n),this.reference=new H(G.fromEdo(12),{C:0,D:2,E:4,F:5,G:7,A:9,B:11},{})}static defaultOptions={divisions:768,time:{beats:4,beatType:4},tempo:60};static accidentals={"#":"sharp","\u266F":"sharp","\uE262":"sharp",n:"natural","\u266E":"natural","\uE261":"natural",b:"flat","\u266D":"flat","\uE260":"flat",x:"double-sharp","\u{1D12A}":"double-sharp","\uE263":"double-sharp","##":"sharp-sharp","\u266F\u266F":"sharp-sharp","\uE269":"sharp-sharp",bb:"flat-flat","\u266D\u266D":"flat-flat","\u{1D12B}":"flat-flat","\uE264":"flat-flat","n#":"natural-sharp","\u266E\u266F":"natural-sharp","\uE268":"natural-sharp",nb:"natural-flat","\u266E\u266D":"natural-flat","\uE267":"natural-flat","#x":"triple-sharp","\u266F\u{1D12A}":"triple-sharp","\uE265":"triple-sharp",bbb:"triple-flat","\u266D\u266D\u266D":"triple-flat","\uE266":"triple-flat","\uE280":"quarter-flat","\uE282":"quarter-sharp","\uE281":"three-quarters-flat","\uE283":"three-quarters-sharp","\uE275":"sharp-down","\uE274":"sharp-up","\uE273":"natural-down","\uE272":"natural-up","\uE271":"flat-down","\uE270":"flat-up","\uE277":"double-sharp-down","\uE276":"double-sharp-up","\uE279":"flat-flat-down","\uE278":"flat-flat-up","\uE27A":"arrow-down","\uE27B":"arrow-up","\uE446":"slash-quarter-sharp","\uE447":"slash-sharp","\uE442":"slash-flat","\uE440":"double-slash-flat","\uE443":"quarter-flat","\uE444":"quarter-sharp","\uE441":"flat","\uE445":"sharp","\uE450":"sharp-1","\uE451":"sharp-2","\uE452":"sharp-3","\uE453":"sharp-5","\uE454":"flat-1","\uE455":"flat-2","\uE456":"flat-3","\uE457":"flat-4","\uE461":"sori","\uE460":"koron"};static durations={8:"eighth",4:"quarter",2:"half",1:"whole"};options;reference;convert(){return Ae(this.convertDocument(),{header:`
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE score-partwise PUBLIC "-//Recordare//DTD MusicXML ${kt} Partwise//EN" "http://www.musicxml.org/dtds/partwise.dtd">
      `.trim(),indent:"  "})}convertDocument(){return{_name:"score-partwise",_attrs:{version:kt},_content:[{work:{"work-title":this.title}},{identification:[{encoding:[{software:`@infojunkie/scalextric ${jt.version}`},{"encoding-date":r.convertDate(new Date)}]}]},{"part-list":{_name:"score-part",_attrs:{id:"P1"},_content:{_name:"part-name",_attrs:{"print-object":"no"},_content:this.title}}},{_name:"part",_attrs:{id:"P1"},_content:this.convertObjects()}]}}convertObjects(){return this.objects.reduce((t,e,n)=>{let i=this.convertMeasure(t.length+1);t.push(i),n>0&&i._content.push({_name:"print",_attrs:{"new-system":"yes"}}),n===0&&i._content.push({attributes:[{divisions:this.options.divisions},{key:[{fifths:0},{mode:"major"}]},{time:[{beats:this.options.time.beats},{"beat-type":this.options.time.beatType}]},{clef:[{sign:"G"},{line:2}]}]},{_name:"direction",_attrs:{placement:"above"},_content:[{"direction-type":[{_name:"metronome",_attrs:{parentheses:"no"},_content:[{"beat-unit":r.durations[this.options.time.beatType]},{"per-minute":this.options.tempo}]}]},{_name:"sound",_attrs:{tempo:this.options.tempo}}]});let l=W.findByLabel("label",e.annotations);l&&i._content.push({_name:"direction",_attrs:{placement:"above"},_content:[{"direction-type":[{words:l[0]}]}]});let c=0;if(e.tones.forEach((S,O)=>{i._content.push(this.convertNote(S,e)),c=(c+1)%this.options.time.beats,c===0&&O<e.tones.length-1&&(i=this.convertMeasure(t.length+1),t.push(i))}),c>0)for(;c++<this.options.time.beats;)i._content.push({_name:"note",_content:[{_name:"rest"},{duration:this.options.divisions},{type:r.durations[this.options.time.beatType]}]});return i._content.push(this.convertBar("right","light-light")),t},[])}convertBar(t,e){return{_name:"barline",_attrs:{location:t},_content:[{"bar-style":e}]}}convertMeasure(t){return{_name:"measure",_attrs:{number:t},_content:[]}}convertNote(t,e){let n=e.solmization.name(t)[0],i=n[0],l=this.convertAccidental(n.slice(1,-1)),c=n[n.length-1],S=this.reference.parse(`${i}${c}`),O=t.tune.difference(S.tune).cents,M=At(O/100,.05);return{_name:"note",_content:[{_name:"pitch",_content:[{step:i},{alter:M},{octave:c}]},{duration:this.options.divisions},{type:r.durations[this.options.time.beatType]},{...l&&l!=="other"&&{accidental:l}},{...l&&l==="other"&&{_name:"accidental",_content:l,_attrs:{smufl:n.slice(1,-1)}}}]}}convertAccidental(t){return t.length?t in r.accidentals?r.accidentals[t]:"other":null}static convertDate(t){return new Date(t.getTime()-t.getTimezoneOffset()*6e4).toISOString().split("T")[0]}};export{W as Annotation,w as Interval,xt as MusicXML,H as Solmization,_ as Tone,it as ToneRow,It as ToneRowSolmized,G as Tuning};
/*! Bundled license information:

fraction.js/fraction.js:
  (**
   * @license Fraction.js v4.3.7 31/08/2023
   * https://www.xarg.org/2014/03/rational-numbers-in-javascript/
   *
   * Copyright (c) 2023, Robert Eisele (robert@raw.org)
   * Dual licensed under the MIT or GPL Version 2 licenses.
   **)
*/
//# sourceMappingURL=scalextric.js.map
